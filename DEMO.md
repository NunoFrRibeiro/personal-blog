# Degger demo workflow

## Build my personal blog live

### Backend 

Web server that listens on port 8080 and parses posts written in Markdown to generate date fed to the templates. 

### Frontend

Located at `./templates`

Static blog with templating to glue html pages together and include variable data generated by the backend in blocks of:

`{{ // genrated code }}`

### Posts

Located at `./posts/`

Marckdown files to be be parsed and passed to the *Frontend* as code.

## CI

Located at `./ci`

### Test

Run the unit Tests for the project

`dagger call -m ./ci test --dir "."`

### Build

Build the Project

`dagger download -m ./ci build --dir "." --env dev`

### Serve

Run and serve the project locally

Web server deployed on `localhost:8080`

### Deploy

`> [!CAUTION]
> TODO: Choose platform to deploy the blog`
Deploy the webserver to CloudFlare/Netlify/???

(Exemple done by kpenfound on dagger greetings-api-demo)
`dagger call -m ./ci deploy --dir "." --fly-token $FLY_TOKEN --netlify-token $NETLIFY_TOKEN`

## DEMO

- Lead with [Daggerverse](https://daggerverse.dev)
	- browse to Kyle Penfound [golang]() module
	- run module against `Backend`: `dagger -m "github.com/kpenfound/dagger-modules/golang@v0.1.10" call --source "."`

- Now pull together multiple modules in `./ci`. This ci uses:
    - golang module in `ci/frontend/main.go` and `ci/backend/main.go`
    - proxy module in `ci/main.go` <- written in python!
    - netlify module in `ci/main.go` <- written in python!
    - fly module in `ci/main.go` <- written in python!
    - github releases in `ci/main.go`

- Show in code:
    - running in containers
    - declarative environments
    - secrets!

- Local runs
    - `dagger functions -m ./ci`
    - `dagger serve ./ci serve --help`
    - `dagger serve -m ./ci -p 8080 serve --dir "."`
    - `curl localhost:8080` to show the result from the backend API
    - navigate to [localhost:8081](http://localhost:8081/) in browser
    - show built blog

- CI
    - create a Markdown post
	- push a commit
    - show `.circleci/config.yml`
	- see run in CircleCI

- Cloud
	- look at all runs
	- look at a run
	- errors? debugging?
	- caching
    - traces
